{"uid":"63d74b3c3cf28c75","name":"test_undefined_device_model_installs","fullName":"tests.test_v_agg_data_additional#test_undefined_device_model_installs","historyId":"806e94d9ae03ace3b161dce632349bf8","time":{"start":1712870183482,"stop":1712870184790,"duration":1308},"description":"\nТест проверяет наличие установок приложений с неопределенной моделью устройства в представлении v_agg_data.\n","descriptionHtml":"<p>Тест проверяет наличие установок приложений с неопределенной моделью устройства в представлении v_agg_data.</p>\n","status":"failed","statusMessage":"AssertionError: Обнаружены установки приложений с неопределенной моделью устройства:\n  Приложение: fd_gp, Количество установок: 1\n  Приложение: hs_as, Количество установок: 8\n  \nassert False","statusTrace":"setup = (<google.cloud.bigquery.client.Client object at 0x7fb6c0e0eb40>, <environment.Environment object at 0x7fb6c0e0f1a0>)\n\n    @allure.story('View_Creation')\n    @allure.severity(allure.severity_level.NORMAL)\n    @allure.description(\"\"\"\n    Тест проверяет наличие установок приложений с неопределенной моделью устройства в представлении v_agg_data.\n    \"\"\")\n    def test_undefined_device_model_installs(setup):\n        \"\"\"\n        Тестирование наличия установок приложений с неопределенной моделью устройства.\n        \"\"\"\n        bq_client, env = setup\n        v_agg_data = env.get_full_table_id('v_agg_data')\n    \n        # Сформируем запрос для выборки имен приложений и подсчета установок, где модель устройства не указана или является пустой строкой.\n        query = f\"\"\"\n            -- Выборка имен приложений и подсчет установок, где модель устройства не указана или пустая строка\n            SELECT app_name, COUNT(*) as total_installs\n            FROM `{v_agg_data}`\n            WHERE device_model IS NULL OR device_model = ''\n            GROUP BY app_name\n        \"\"\"\n    \n        # Используем вспомогательную функцию для выполнения запроса и логирования его в Allure.\n        results = execute_query_and_log(bq_client, query, \"Поиск установок с неопределенной моделью устройства\",\n                                        include_query_in_message=True)\n    \n        # Преобразуем результаты запроса в список кортежей для дальнейшего анализа.\n        undefined_device_model_installs = [(row.app_name, row.total_installs) for row in results]\n    \n        # Если найдены установки с неопределенной моделью устройства, составляем сообщение об ошибке с деталями.\n        if len(undefined_device_model_installs) > 0:\n            error_message = \"Обнаружены установки приложений с неопределенной моделью устройства:\\n\"\n            for app_name, total_installs in undefined_device_model_installs:\n                error_message += f\"Приложение: {app_name}, Количество установок: {total_installs}\\n\"\n>           assert False, error_message\nE           AssertionError: Обнаружены установки приложений с неопределенной моделью устройства:\nE             Приложение: fd_gp, Количество установок: 1\nE             Приложение: hs_as, Количество установок: 8\nE             \nE           assert False\n\ntests/test_v_agg_data_additional.py:154: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"setup","time":{"start":1712870177591,"stop":1712870177592,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\nТест проверяет наличие установок приложений с неопределенной моделью устройства в представлении v_agg_data.\n","status":"failed","statusMessage":"AssertionError: Обнаружены установки приложений с неопределенной моделью устройства:\n  Приложение: fd_gp, Количество установок: 1\n  Приложение: hs_as, Количество установок: 8\n  \nassert False","statusTrace":"setup = (<google.cloud.bigquery.client.Client object at 0x7fb6c0e0eb40>, <environment.Environment object at 0x7fb6c0e0f1a0>)\n\n    @allure.story('View_Creation')\n    @allure.severity(allure.severity_level.NORMAL)\n    @allure.description(\"\"\"\n    Тест проверяет наличие установок приложений с неопределенной моделью устройства в представлении v_agg_data.\n    \"\"\")\n    def test_undefined_device_model_installs(setup):\n        \"\"\"\n        Тестирование наличия установок приложений с неопределенной моделью устройства.\n        \"\"\"\n        bq_client, env = setup\n        v_agg_data = env.get_full_table_id('v_agg_data')\n    \n        # Сформируем запрос для выборки имен приложений и подсчета установок, где модель устройства не указана или является пустой строкой.\n        query = f\"\"\"\n            -- Выборка имен приложений и подсчет установок, где модель устройства не указана или пустая строка\n            SELECT app_name, COUNT(*) as total_installs\n            FROM `{v_agg_data}`\n            WHERE device_model IS NULL OR device_model = ''\n            GROUP BY app_name\n        \"\"\"\n    \n        # Используем вспомогательную функцию для выполнения запроса и логирования его в Allure.\n        results = execute_query_and_log(bq_client, query, \"Поиск установок с неопределенной моделью устройства\",\n                                        include_query_in_message=True)\n    \n        # Преобразуем результаты запроса в список кортежей для дальнейшего анализа.\n        undefined_device_model_installs = [(row.app_name, row.total_installs) for row in results]\n    \n        # Если найдены установки с неопределенной моделью устройства, составляем сообщение об ошибке с деталями.\n        if len(undefined_device_model_installs) > 0:\n            error_message = \"Обнаружены установки приложений с неопределенной моделью устройства:\\n\"\n            for app_name, total_installs in undefined_device_model_installs:\n                error_message += f\"Приложение: {app_name}, Количество установок: {total_installs}\\n\"\n>           assert False, error_message\nE           AssertionError: Обнаружены установки приложений с неопределенной моделью устройства:\nE             Приложение: fd_gp, Количество установок: 1\nE             Приложение: hs_as, Количество установок: 8\nE             \nE           assert False\n\ntests/test_v_agg_data_additional.py:154: AssertionError","steps":[{"name":"Поиск установок с неопределенной моделью устройства\n\nExecuted query:\n\n        -- Выборка имен приложений и подсчет установок, где модель устройства не указана или пустая строка\n        SELECT app_name, COUNT(*) as total_installs\n        FROM `data-quality-project-1.dq_data_set.v_agg_data`\n        WHERE device_model IS NULL OR device_model = ''\n        GROUP BY app_name\n    ","time":{"start":1712870183482,"stop":1712870184556,"duration":1074},"status":"passed","steps":[],"attachments":[{"uid":"c75309ef4e1396fb","name":"SQL Query","source":"c75309ef4e1396fb.txt","type":"text/plain","size":388}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":1,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"story","value":"View_Creation"},{"name":"severity","value":"normal"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_v_agg_data_additional"},{"name":"host","value":"cb7398c278e1"},{"name":"thread","value":"1-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_v_agg_data_additional"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"63d74b3c3cf28c75.json","parameterValues":[]}